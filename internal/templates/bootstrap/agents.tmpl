# Contributor Guidelines

This document provides instructions for AI coding agents working on this project.

## Project Overview

- **Name**: {{ .Name }}
- **Type**: {{ .Kind }}
{{- if eq .Kind "website" }}
- **Stack**: TypeScript, React, React Router, TanStack Query, Tailwind CSS
{{- if .HasFeature "convex" }}
- **Backend**: Convex (real-time data, functions, auth)
{{- end }}
{{- if .Website }}{{- if .Website.Deployment }}
- **Deployment**: {{ .Website.Deployment | title }}
{{- end }}{{- end }}
{{- end }}
{{- if eq .Kind "tui" }}
- **Stack**: Go, Bubble Tea, Bubbles, Lip Gloss, Huh
{{- end }}
{{- if eq .Kind "ios" }}
- **Stack**: Swift, UIKit, @Observable, Diffable Collection View
{{- if .IOS }}{{- if .IOS.Tuist }}
- **Build System**: Tuist
{{- end }}{{- end }}
{{- end }}

## Code Style

{{- if eq .Kind "website" }}
- Use TypeScript strict mode
- Prefer functional components with hooks
- Use TanStack Query for server state
- Use Tailwind CSS for styling (no CSS modules)
- Use Vitest for testing
{{- end }}

{{- if eq .Kind "tui" }}
- Use Go standard library unless a dependency is explicitly allowed
- Follow Elm architecture for TUI components (Model, Update, View)
- Keep Update pure; use Commands for I/O
- Use charmbracelet/log for logging (never fmt.Printf for diagnostics)
- Use Go's "testing" package for tests

### Spinners for long operations
Any operation that may take >500ms MUST use a spinner:

```go
err := ui.RunWithSpinner(ctx, "Installing dependencies", func() error {
    return runner.Run(ctx, "pnpm", "add", "some-package")
})
```

- Never show raw log output during long operations
- Spinners show ✓ on success, ✗ on failure automatically

### External CLI wrappers
When wrapping external CLIs (git, gh, etc.):

```go
cmd := exec.CommandContext(ctx, "gh", "repo", "view", repo)
out, err := cmd.CombinedOutput()  // Always capture stderr!
if err != nil {
    return fmt.Errorf("gh repo view: %s", strings.TrimSpace(string(out)))
}
```

- Always use `CombinedOutput()` to capture stderr for error messages
- Support `DryRun` option for destructive operations
- Check prerequisites before executing (e.g., is gh authenticated?)

### Safe filesystem operations
For user-facing deletions, use confirmation prompts:

```go
err := ops.Remove(path, ops.RemoveOptions{
    Force:  c.Yes,     // Skip confirmation with -y flag
    DryRun: c.DryRun,  // Show what would happen
})
```

- Never use `os.RemoveAll` directly for user-facing deletions
- Always support `--dry-run` and `-y/--yes` flags

### Homebrew release process

If distributing via Homebrew tap:

1. **Tag the release:**
   ```bash
   git tag vX.Y.Z && git push --tags
   ```

2. **Get SHA256:**
   ```bash
   curl -sL https://github.com/OWNER/REPO/archive/refs/tags/vX.Y.Z.tar.gz | shasum -a 256
   ```

3. **Update formula and create PR:**
   ```bash
   cd /path/to/homebrew-tap
   git checkout -b bump-vX.Y.Z
   # Edit Formula/NAME.rb: update url version and sha256
   git commit -am "NAME vX.Y.Z"
   git push -u origin bump-vX.Y.Z
   gh pr create --title "NAME vX.Y.Z" --body "Version bump"
   ```

4. **Wait for CI** (test-bot builds bottles on PR)

5. **Merge with bottles:**
   ```bash
   gh pr edit <PR#> --add-label pr-pull
   ```

Formula conventions:
- Description must not start with "A", "An", "The"
- SHA256 must be lowercase, 64 characters
- Use env vars in workflows to avoid script injection
{{- end }}

{{- if eq .Kind "ios" }}
- Use UIKit (not SwiftUI)
- Use @Observable for reactive state management
- Use Diffable Collection View for lists
- Use Swift Testing framework for tests
- Never require opening Xcode; use CLI commands
{{- end }}

## Task Workflow

1. Read and understand the existing code before making changes
2. Make minimal, focused changes
3. Run tests after changes: `mise run test`
4. Run linter before committing: `mise run lint`

## File Structure

```
{{- if eq .Kind "website" }}
src/
  components/   # React components
  routes/       # React Router routes
  lib/          # Utilities and helpers
  hooks/        # Custom React hooks
{{- if .HasFeature "convex" }}
convex/         # Convex functions and schema
{{- end }}
{{- end }}
{{- if eq .Kind "tui" }}
cmd/{{ lower .Name }}/  # CLI entrypoint
internal/
  cli/          # Kong commands
  tui/          # Bubble Tea models
  ui/           # Lip Gloss styles, spinners
  ops/          # Safe filesystem operations
  shell/        # Shell command runner
  config/       # Config loading
{{- end }}
{{- if eq .Kind "ios" }}
{{ .Name }}/
  App/          # App delegate, scenes
  Views/        # View controllers
  Models/       # Data models
  Services/     # Business logic
{{- end }}
```

{{- if .HasFeature "claude" }}

## Claude Code Specific

- Use `/compact` periodically to manage context
- Prefer editing existing files over creating new ones
- Ask clarifying questions when requirements are ambiguous
{{- end }}

{{- if .HasFeature "codex" }}

## Codex Specific

- Keep responses concise and code-focused
- Provide complete, runnable code snippets
{{- end }}

{{- if .HasFeature "gemini" }}

## Gemini CLI Specific

- Follow project conventions strictly
- Reference existing patterns in the codebase
{{- end }}
