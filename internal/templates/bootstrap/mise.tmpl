{{- if eq .Kind "website" -}}
[tools]
node = "{{ default "24" .Config.Tooling.Node }}"
pnpm = "{{ default "latest" .Config.Tooling.Pnpm }}"

[env]
_.path = ['{{ "{{config_root}}" }}/node_modules/.bin']

[hooks]
postinstall = """
if [ "$CI" = "true" ]; then
  echo 'âœ… Skipping typegen in CI'
  exit 0
fi

mise run typegen:*
"""

[tasks.dev]
description = "Run the development server"
run = "pnpm dev -- --host"

[tasks.build]
description = "Build the app"
sources = [
    "pnpm-lock.yaml",
    "react-router.config.ts",
    "vite.config.ts",
    "tsconfig.json",
{{- if .Website }}{{- if eq .Website.Deployment "cloudflare" }}
    "worker-configuration.d.ts",
{{- end }}{{- end }}
    "app/**/*.{ts,tsx,css,json,md}",
    "workers/**/*.{ts,tsx,js}",
]
outputs = ["build"]
run = "pnpm build"

[tasks.preview]
description = "Preview the built application"
depends = "build"
run = "pnpm preview"

{{- if .Website }}{{- if eq .Website.Deployment "cloudflare" }}

[tasks.deploy]
description = "Deploy to Cloudflare Workers"
depends = "build"
confirm = "Are you sure you want to deploy to Cloudflare Workers?"
run = "pnpm deploy"
{{- end }}{{- end }}

[tasks.fmt]
description = "Format the project with Prettier"
run = "pnpm fmt"

[tasks.lint]
description = "Lint the project with oxlint"
run = "pnpm lint"

[tasks.check]
description = "Format and lint the project"
depends = ["fmt", "lint"]

{{- if .Website }}{{- if eq .Website.Deployment "cloudflare" }}

[tasks."typegen:cloudflare"]
description = "Generate types for Cloudflare bindings"
sources = ["wrangler.jsonc"]
outputs = ["worker-configuration.d.ts"]
run = "pnpm exec wrangler types"
{{- end }}{{- end }}

[tasks."typegen:react-router"]
description = "Generate types for React Router routes"
sources = ["react-router.config.ts", "vite.config.ts", "app/**/*.{ts,tsx}"]
outputs = [".react-router"]
run = "pnpm exec react-router typegen"

[tasks.typecheck]
description = "Typecheck the project"
depends = "typegen:*"
run = "pnpm typecheck"
{{- end }}

{{- if eq .Kind "tui" }}
[tools]
go = "1.24"

[tasks.dev]
description = "Run the application"
run = "go run ./cmd/{{ lower .Name }}"

[tasks.build]
description = "Build the binary"
run = "go build -o bin/{{ lower .Name }} ./cmd/{{ lower .Name }}"

[tasks.fmt]
description = "Format Go code"
run = "go fmt ./..."

[tasks.lint]
description = "Run linter"
run = "go vet ./..."

[tasks.check]
description = "Format and lint the project"
depends = ["fmt", "lint"]

[tasks.test]
description = "Run tests"
run = "go test ./..."

[tasks.tidy]
description = "Tidy go.mod"
run = "go mod tidy"
{{- end }}

{{- if eq .Kind "ios" }}
[tools]
# iOS tooling managed by Xcode/Tuist

[tasks.generate]
description = "Generate Xcode project with Tuist"
run = "tuist generate"

[tasks.build]
description = "Build the app"
depends = "generate"
run = "xcodebuild build -workspace {{ .Name }}.xcworkspace -scheme {{ .Name }}"

[tasks.test]
description = "Run tests in simulator"
depends = "generate"
run = "xcodebuild test -workspace {{ .Name }}.xcworkspace -scheme {{ .Name }} -destination 'platform=iOS Simulator,name=iPhone 16'"

[tasks.fmt]
description = "Format Swift code"
run = "swift-format format -i -r Sources Tests"

[tasks.lint]
description = "Lint Swift code"
run = "swift-format lint -r Sources Tests"

[tasks.check]
description = "Format and lint the project"
depends = ["fmt", "lint"]
{{- end }}
